# Media Index Services

get_random_items:
  name: Get Random Media Items
  description: Get random media items from the index with optional filtering
  target:
    entity:
      integration: media_index
      domain: sensor
  fields:
    count:
      name: Count
      description: Number of random items to return
      example: 10
      default: 1
      selector:
        number:
          min: 1
          max: 100
          mode: box
    folder:
      name: Folder
      description: Optional folder path to filter by (full path including base folder)
      example: "/media/photo/Photos/2023"
      selector:
        text:
    file_type:
      name: File Type
      description: Filter by file type (image or video)
      example: "image"
      selector:
        select:
          options:
            - "image"
            - "video"
    date_from:
      name: Date From
      description: Filter files with date >= this value (YYYY-MM-DD). Uses EXIF date_taken if available, falls back to created_time.
      example: "2023-01-01"
      selector:
        date:
    date_to:
      name: Date To
      description: Filter files with date <= this value (YYYY-MM-DD). Uses EXIF date_taken if available, falls back to created_time.
      example: "2023-12-31"
      selector:
        date:
    favorites_only:
      name: Favorites Only
      description: If true, only return files marked as favorites
      default: false
      selector:
        boolean:
    priority_new_files:
      name: Priority New Files
      description: If true, prioritize recently scanned files before random selection
      default: false
      selector:
        boolean:
    new_files_threshold_seconds:
      name: New Files Threshold
      description: Seconds threshold for considering files "new" (default 3600 = 1 hour)
      default: 3600
      selector:
        number:
          min: 60
          max: 86400
          mode: box

get_ordered_files:
  name: Get Ordered Media Files
  description: Get ordered media files with configurable sort field and direction
  target:
    entity:
      integration: media_index
      domain: sensor
  fields:
    count:
      name: Count
      description: Maximum number of files to return
      default: 50
      selector:
        number:
          min: 1
          max: 1000
          mode: box
    folder:
      name: Folder
      description: Folder path to filter by (full path including base folder)
      example: "/media/photo/Photos/2023"
      selector:
        text:
    recursive:
      name: Recursive
      description: Include subfolders (sorts across all files when true)
      default: true
      selector:
        boolean:
    file_type:
      name: File Type
      description: Filter by file type (image or video)
      example: "image"
      selector:
        select:
          options:
            - "image"
            - "video"
    order_by:
      name: Order By
      description: Which field to sort by
      default: "date_taken"
      selector:
        select:
          options:
            - label: "Date Taken (EXIF)"
              value: "date_taken"
            - label: "Filename (Alphabetical)"
              value: "filename"
            - label: "Path (Folder Hierarchy)"
              value: "path"
            - label: "Modified Time (Filesystem)"
              value: "modified_time"
    order_direction:
      name: Order Direction
      description: Sort direction (ascending or descending)
      default: "desc"
      selector:
        select:
          options:
            - label: "Descending (Newest/Z-A First)"
              value: "desc"
            - label: "Ascending (Oldest/A-Z First)"
              value: "asc"

get_file_metadata:
  name: Get File Metadata
  description: Get detailed metadata for a specific file
  target:
    entity:
      integration: media_index
      domain: sensor
  fields:
    file_path:
      name: File Path
      description: Full filesystem path to the media file (use either this OR media_source_uri)
      required: false
      example: "/media/photo/Photos/2023/vacation.jpg"
      selector:
        text:
    media_source_uri:
      name: Media Source URI
      description: Media-source URI (use either this OR file_path)
      required: false
      example: "media-source://media_source/media/photo/Photos/2023/vacation.jpg"
      selector:
        text:

geocode_file:
  name: Geocode File
  description: Get location name for a file with GPS coordinates (cache-first, on-demand)
  target:
    entity:
      integration: media_index
      domain: sensor
  fields:
    file_id:
      name: File ID
      description: Database ID of the file to geocode
      required: false
      selector:
        number:
          min: 1
          mode: box
    file_path:
      name: File Path
      description: Full filesystem path to the media file (use this OR file_id OR media_source_uri)
      required: false
      example: "/media/photo/Photos/2023/vacation.jpg"
      selector:
        text:
    media_source_uri:
      name: Media Source URI
      description: Media-source URI (use this OR file_id OR file_path)
      required: false
      example: "media-source://media_source/media/photo/Photos/2023/vacation.jpg"
      selector:
        text:
    latitude:
      name: Latitude
      description: GPS latitude (alternative to file_id/file_path/media_source_uri)
      required: false
      selector:
        number:
          min: -90
          max: 90
          mode: box
    longitude:
      name: Longitude
      description: GPS longitude (alternative to file_id/file_path/media_source_uri)
      required: false
      selector:
        number:
          min: -180
          max: 180
          mode: box

scan_folder:
  name: Scan Folder
  description: Manually trigger a folder scan
  target:
    entity:
      integration: media_index
      domain: sensor
  fields:
    folder_path:
      name: Folder Path
      description: Folder to scan (defaults to base folder if not specified)
      example: "/media/photo/Photos"
      selector:
        text:
    force_rescan:
      name: Force Rescan
      description: Force re-scan of all files even if unchanged
      default: false
      selector:
        boolean:

mark_favorite:
  name: Mark File as Favorite
  description: Mark a file as favorite (updates EXIF and database)
  target:
    entity:
      integration: media_index
      domain: sensor
  fields:
    file_path:
      name: File Path
      description: Full filesystem path to the media file (use either this OR media_source_uri)
      required: false
      example: "/media/photo/Photos/2023/vacation.jpg"
      selector:
        text:
    media_source_uri:
      name: Media Source URI
      description: Media-source URI (use either this OR file_path)
      required: false
      example: "media-source://media_source/media/photo/Photos/2023/vacation.jpg"
      selector:
        text:
    is_favorite:
      name: Is Favorite
      description: True to mark as favorite, False to unmark
      default: true
      selector:
        boolean:

delete_media:
  name: Delete Media File
  description: Move a media file to the junk folder (soft delete)
  target:
    entity:
      integration: media_index
      domain: sensor
  fields:
    file_path:
      name: File Path
      description: Full filesystem path to the media file (use either this OR media_source_uri)
      required: false
      example: "/media/photo/Photos/2023/bad_hair_day.jpg"
      selector:
        text:
    media_source_uri:
      name: Media Source URI
      description: Media-source URI (use either this OR file_path)
      required: false
      example: "media-source://media_source/media/photo/Photos/2023/bad_hair_day.jpg"
      selector:
        text:

mark_for_edit:
  name: Mark File for Editing
  description: Move a media file to the edit folder for processing
  target:
    entity:
      integration: media_index
      domain: sensor
  fields:
    file_path:
      name: File Path
      description: Full filesystem path to the media file (use either this OR media_source_uri)
      required: false
      example: "/media/photo/Photos/2023/needs_editing.jpg"
      selector:
        text:
    media_source_uri:
      name: Media Source URI
      description: Media-source URI (use either this OR file_path)
      required: false
      example: "media-source://media_source/media/photo/Photos/2023/needs_editing.jpg"
      selector:
        text:

restore_edited_files:
  name: Restore Edited Files
  description: Restore files from the edit folder back to their original locations
  target:
    entity:
      integration: media_index
      domain: sensor
  fields:
    folder_filter:
      name: Folder Filter
      description: Filter by destination folder (defaults to "_Edit")
      default: "_Edit"
      example: "_Edit"
      selector:
        text:
    file_path:
      name: File Path
      description: Optional - restore only this specific file
      example: "/media/photo/Photos/2023/edited_photo.jpg"
      selector:
        text:
