# Media Index Services

get_random_items:
  name: Get Random Media Items
  description: Get random media items from the index with optional filtering
  target:
    entity:
      integration: media_index
      domain: sensor
  fields:
    count:
      name: Count
      description: Number of random items to return
      example: 10
      default: 1
      selector:
        number:
          min: 1
          max: 100
          mode: box
    folder:
      name: Folder
      description: Optional folder path to filter by (full path including base folder)
      example: "/media/photo/Photos/2023"
      selector:
        text:
    file_type:
      name: File Type
      description: Filter by file type (image or video)
      example: "image"
      selector:
        select:
          options:
            - "image"
            - "video"
    date_from:
      name: Date From
      description: Filter files with date >= this value (YYYY-MM-DD). Uses EXIF date_taken if available, falls back to created_time.
      example: "2023-01-01"
      selector:
        date:
    date_to:
      name: Date To
      description: Filter files with date <= this value (YYYY-MM-DD). Uses EXIF date_taken if available, falls back to created_time.
      example: "2023-12-31"
      selector:
        date:
    anniversary_month:
      name: Anniversary Month
      description: "Filter by month (1-12) across any year. Use with anniversary_day for 'On This Day' queries. Supports wildcard: use '*' for any month."
      example: "12"
      selector:
        text:
    anniversary_day:
      name: Anniversary Day
      description: "Filter by day of month (1-31) across any year. Use with anniversary_month for 'On This Day' queries. Supports wildcard: use '*' for any day."
      example: "25"
      selector:
        text:
    anniversary_window_days:
      name: Anniversary Window Days
      description: "Expand anniversary match by ±N days. E.g., anniversary_day=7 with window=3 matches days 4-10."
      default: 0
      selector:
        number:
          min: 0
          max: 31
          mode: box
    favorites_only:
      name: Favorites Only
      description: If true, only return files marked as favorites
      default: false
      selector:
        boolean:
    priority_new_files:
      name: Priority New Files
      description: If true, prioritize recently scanned files before random selection
      default: false
      selector:
        boolean:
    new_files_threshold_seconds:
      name: New Files Threshold
      description: Seconds threshold for considering files "new" (default 3600 = 1 hour)
      default: 3600
      selector:
        number:
          min: 60
          max: 86400
          mode: box

get_ordered_files:
  name: Get Ordered Media Files
  description: Get ordered media files with configurable sort field and direction
  target:
    entity:
      integration: media_index
      domain: sensor
  fields:
    count:
      name: Count
      description: Maximum number of files to return
      default: 50
      selector:
        number:
          min: 1
          max: 1000
          mode: box
    folder:
      name: Folder
      description: Folder path to filter by (full path including base folder)
      example: "/media/photo/Photos/2023"
      selector:
        text:
    recursive:
      name: Recursive
      description: Include subfolders (sorts across all files when true)
      default: true
      selector:
        boolean:
    file_type:
      name: File Type
      description: Filter by file type (image or video)
      example: "image"
      selector:
        select:
          options:
            - "image"
            - "video"
    order_by:
      name: Order By
      description: Which field to sort by
      default: "date_taken"
      selector:
        select:
          options:
            - label: "Date Taken (EXIF)"
              value: "date_taken"
            - label: "Filename (Alphabetical)"
              value: "filename"
            - label: "Path (Folder Hierarchy)"
              value: "path"
            - label: "Modified Time (Filesystem)"
              value: "modified_time"
    order_direction:
      name: Order Direction
      description: Sort direction (ascending or descending)
      default: "desc"
      selector:
        select:
          options:
            - label: "Descending (Newest/Z-A First)"
              value: "desc"
            - label: "Ascending (Oldest/A-Z First)"
              value: "asc"

get_file_metadata:
  name: Get File Metadata
  description: Get detailed metadata for a specific file
  target:
    entity:
      integration: media_index
      domain: sensor
  fields:
    file_path:
      name: File Path
      description: Full filesystem path to the media file (use either this OR media_source_uri)
      required: false
      example: "/media/photo/Photos/2023/vacation.jpg"
      selector:
        text:
    media_source_uri:
      name: Media Source URI
      description: Media-source URI (use either this OR file_path)
      required: false
      example: "media-source://media_source/media/photo/Photos/2023/vacation.jpg"
      selector:
        text:

get_related_files:
  name: Get Related Files
  description: Get files related to a reference photo (burst detection - photos taken within minutes)
  target:
    entity:
      integration: media_index
      domain: sensor
  fields:
    mode:
      name: Mode
      description: Type of related files to find
      required: true
      selector:
        select:
          options:
            - label: "Burst (photos within minutes)"
              value: "burst"
    reference_path:
      name: Reference File Path
      description: Full filesystem path to the reference media file (use media_source_uri instead when possible)
      required: false
      example: "/media/photo/Photos/2023/IMG_1234.jpg"
      selector:
        text:
    media_source_uri:
      name: Media Source URI
      description: Media-source URI for the reference media file (recommended)
      required: false
      example: "media-source://media_source/media/photo/Photos/2023/IMG_1234.jpg"
      selector:
        text:
    time_window_seconds:
      name: Time Window (Burst Mode)
      description: Time window in seconds (±) around reference photo's timestamp (burst mode only)
      default: 120
      selector:
        number:
          min: 10
          max: 3600
          mode: box
    prefer_same_location:
      name: Prefer Same Location (Burst Mode)
      description: Filter by GPS proximity if available (burst mode only, fallback to time-only if no GPS)
      default: true
      selector:
        boolean:
    location_tolerance_meters:
      name: Location Tolerance (Burst Mode)
      description: Maximum distance in meters for GPS matching (burst mode only)
      default: 50
      selector:
        number:
          min: 10
          max: 1000
          mode: box
    window_days:
      name: Window Days (Anniversary Mode)
      description: Days before/after reference date to include (anniversary mode only, e.g., 3 = ±3 days)
      default: 3
      selector:
        number:
          min: 0
          max: 30
          mode: box
    years_back:
      name: Years Back (Anniversary Mode)
      description: How many years back to search (anniversary mode only)
      default: 15
      selector:
        number:
          min: 1
          max: 50
          mode: box
    sort_order:
      name: Sort Order
      description: How to order results
      default: "time_asc"
      selector:
        select:
          options:
            - label: "Time Ascending (Chronological)"
              value: "time_asc"
            - label: "Time Descending (Reverse)"
              value: "time_desc"

geocode_file:
  name: Geocode File
  description: Get location name for a file with GPS coordinates (cache-first, on-demand)
  target:
    entity:
      integration: media_index
      domain: sensor
  fields:
    file_id:
      name: File ID
      description: Database ID of the file to geocode
      required: false
      selector:
        number:
          min: 1
          mode: box
    file_path:
      name: File Path
      description: Full filesystem path to the media file (use this OR file_id OR media_source_uri)
      required: false
      example: "/media/photo/Photos/2023/vacation.jpg"
      selector:
        text:
    media_source_uri:
      name: Media Source URI
      description: Media-source URI (use this OR file_id OR file_path)
      required: false
      example: "media-source://media_source/media/photo/Photos/2023/vacation.jpg"
      selector:
        text:
    latitude:
      name: Latitude
      description: GPS latitude (alternative to file_id/file_path/media_source_uri)
      required: false
      selector:
        number:
          min: -90
          max: 90
          mode: box
    longitude:
      name: Longitude
      description: GPS longitude (alternative to file_id/file_path/media_source_uri)
      required: false
      selector:
        number:
          min: -180
          max: 180
          mode: box

scan_folder:
  name: Scan Folder
  description: Manually trigger a folder scan
  target:
    entity:
      integration: media_index
      domain: sensor
  fields:
    folder_path:
      name: Folder Path
      description: Folder to scan (defaults to base folder if not specified)
      example: "/media/photo/Photos"
      selector:
        text:
    force_rescan:
      name: Force Rescan
      description: Force re-scan of all files even if unchanged
      default: false
      selector:
        boolean:

mark_favorite:
  name: Mark File as Favorite
  description: Mark a file as favorite (updates EXIF and database)
  target:
    entity:
      integration: media_index
      domain: sensor
  fields:
    file_path:
      name: File Path
      description: Full filesystem path to the media file (use either this OR media_source_uri)
      required: false
      example: "/media/photo/Photos/2023/vacation.jpg"
      selector:
        text:
    media_source_uri:
      name: Media Source URI
      description: Media-source URI (use either this OR file_path)
      required: false
      example: "media-source://media_source/media/photo/Photos/2023/vacation.jpg"
      selector:
        text:
    is_favorite:
      name: Is Favorite
      description: True to mark as favorite, False to unmark
      default: true
      selector:
        boolean:

delete_media:
  name: Delete Media File
  description: Move a media file to the junk folder (soft delete)
  target:
    entity:
      integration: media_index
      domain: sensor
  fields:
    file_path:
      name: File Path
      description: Full filesystem path to the media file (use either this OR media_source_uri)
      required: false
      example: "/media/photo/Photos/2023/bad_hair_day.jpg"
      selector:
        text:
    media_source_uri:
      name: Media Source URI
      description: Media-source URI (use either this OR file_path)
      required: false
      example: "media-source://media_source/media/photo/Photos/2023/bad_hair_day.jpg"
      selector:
        text:

mark_for_edit:
  name: Mark File for Editing
  description: Move a media file to the edit folder for processing
  target:
    entity:
      integration: media_index
      domain: sensor
  fields:
    file_path:
      name: File Path
      description: Full filesystem path to the media file (use either this OR media_source_uri)
      required: false
      example: "/media/photo/Photos/2023/needs_editing.jpg"
      selector:
        text:
    media_source_uri:
      name: Media Source URI
      description: Media-source URI (use either this OR file_path)
      required: false
      example: "media-source://media_source/media/photo/Photos/2023/needs_editing.jpg"
      selector:
        text:

restore_edited_files:
  name: Restore Edited Files
  description: Restore files from the edit folder back to their original locations
  target:
    entity:
      integration: media_index
      domain: sensor
  fields:
    folder_filter:
      name: Folder Filter
      description: Filter by destination folder (defaults to "_Edit")
      default: "_Edit"
      example: "_Edit"
      selector:
        text:
    file_path:
      name: File Path
      description: Optional - restore only this specific file
      example: "/media/photo/Photos/2023/edited_photo.jpg"
      selector:
        text:

cleanup_database:
  name: Cleanup Database
  description: Remove database entries for files that no longer exist on the filesystem
  target:
    entity:
      integration: media_index
      domain: sensor
  fields:
    dry_run:
      name: Dry Run
      description: If true, only report what would be deleted without actually deleting
      default: true
      selector:
        boolean:

update_burst_metadata:
  name: Update Burst Metadata
  description: Write burst_favorites metadata to all files in a burst group
  target:
    entity:
      integration: media_index
      domain: sensor
  fields:
    burst_files:
      name: Burst Files
      description: List of all file URIs in the burst group
      required: true
      example: ["media-source://media_source/media/photo/burst/IMG_001.jpg", "media-source://media_source/media/photo/burst/IMG_002.jpg"]
      selector:
        object:
    favorited_files:
      name: Favorited Files
      description: List of file URIs that were marked as favorites
      required: true
      example: ["media-source://media_source/media/photo/burst/IMG_001.jpg"]
      selector:
        object:

check_file_exists:
  name: Check File Exists
  description: Lightweight filesystem check to verify if a file exists (no metadata loading)
  target:
    entity:
      integration: media_index
      domain: sensor
  fields:
    file_path:
      name: File Path
      description: Full filesystem path to check
      example: "/media/photo/Photos/2023/IMG_001.jpg"
      selector:
        text:
    media_source_uri:
      name: Media Source URI
      description: Media-source URI to check (alternative to file_path)
      example: "media-source://media_source/media/photo/Photos/2023/IMG_001.jpg"
      selector:
        text:
